<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Comprehensive security features of EpicServer including CORS protection, rate limiting, CSRF protection, security headers, authentication, and input validation.">
    <meta name="keywords" content="Go, Golang, Web Security, CORS, CSRF, Rate Limiting, Authentication, Security Headers, Input Validation">
    <meta name="author" content="tomskip123">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Security Features - EpicServer Documentation">
    <meta property="og:description" content="Comprehensive security features of EpicServer including CORS protection, rate limiting, CSRF protection, security headers, authentication, and input validation.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/EpicServer/security.html">
    <title>Security Features - EpicServer Documentation</title>
    <link rel="stylesheet" href="styles.css">
    <script src="script.js"></script>
    <link rel="canonical" href="/EpicServer/security.html">
    <!-- Add highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    </script>
</head>
<body>
    <header>
        <nav class="nav" aria-label="Main Navigation">
            <a href="index.html">Home</a>
            <a href="getting-started.html">Getting Started</a>
            <a href="core-features.html">Core Features</a>
            <a href="advanced-usage.html">Advanced Usage</a>
            <a href="security.html">Security</a>
            <a href="package-reference.html">Package Reference</a>
            <a href="changelog.html">Changelog</a>
        </nav>
    </header>

    <main class="container">
        <article>
            <header>
                <h1>Security Features</h1>
            </header>
            
            <nav class="toc" aria-labelledby="page-contents">
                <h3 id="page-contents">On This Page</h3>
                <ul>
                    <li><a href="#overview">Security Overview</a></li>
                    <li><a href="#cors">CORS Protection</a></li>
                    <li><a href="#rate-limiting">Rate Limiting</a></li>
                    <li><a href="#csrf">CSRF Protection</a></li>
                    <li><a href="#security-headers">Security Headers</a></li>
                    <li><a href="#authentication">Authentication</a></li>
                    <li><a href="#input-validation">Input Validation</a></li>
                    <li><a href="#best-practices">Security Best Practices</a></li>
                </ul>
            </nav>

            <section id="overview" aria-labelledby="overview-title">
                <h2 id="overview-title">Security Overview</h2>
                <p>EpicServer provides a comprehensive set of security features to help protect your application from common web vulnerabilities. These features are designed to be easy to use while providing robust protection.</p>
                
                <div class="warning">
                    <p><strong>Important:</strong> While EpicServer includes many security features, it's important to understand that security is a complex topic that requires ongoing attention. Always keep your dependencies updated and follow security best practices.</p>
                </div>
            </section>

            <section id="cors" aria-labelledby="cors-title">
                <h2 id="cors-title">CORS Protection</h2>
                <p>Cross-Origin Resource Sharing (CORS) is a mechanism that allows resources on a web page to be requested from another domain outside the domain from which the resource originated.</p>
                
                <h3>Basic CORS Configuration</h3>
                <div class="code-container">
                    <div class="code-header">main.go</div>
                    <pre><code class="language-go">server.UpdateAppLayer([]EpicServer.AppLayer{
    EpicServer.WithCors([]string{"*"}), // Allow all origins (not recommended for production)
})</code></pre>
                </div>

                <h3>Production CORS Configuration</h3>
                <div class="code-container">
                    <div class="code-header">main.go</div>
                    <pre><code class="language-go">server.UpdateAppLayer([]EpicServer.AppLayer{
    EpicServer.WithCors([]string{
        "https://example.com",
        "https://api.example.com",
    }),
})</code></pre>
                </div>

                <h3>Advanced CORS Configuration</h3>
                <p>For more advanced CORS configuration, you can use the Gin CORS middleware directly:</p>
                <div class="code-container">
                    <div class="code-header">cors_config.go</div>
                    <pre><code class="language-go">import (
    "github.com/gin-contrib/cors"
    "time"
)

// ...

config := cors.Config{
    AllowOrigins:     []string{"https://example.com"},
    AllowMethods:     []string{"GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"},
    AllowHeaders:     []string{"Origin", "Content-Type", "Accept", "Authorization"},
    ExposeHeaders:    []string{"Content-Length"},
    AllowCredentials: true,
    MaxAge:           12 * time.Hour,
}

server.Engine.Use(cors.New(config))</code></pre>
                </div>
            </section>

            <section id="rate-limiting" aria-labelledby="rate-limiting-title">
                <h2 id="rate-limiting-title">Rate Limiting</h2>
                <p>Rate limiting helps protect your application from abuse by limiting the number of requests a client can make in a given time period.</p>
                
                <h3>Basic Rate Limiting</h3>
                <div class="code-container">
                    <div class="code-header">rate_limiter.go</div>
                    <pre><code class="language-go">server.UpdateAppLayer([]EpicServer.AppLayer{
    EpicServer.WithRateLimiter(EpicServer.RateLimiterConfig{
        MaxRequests:   100,
        Interval:      time.Minute,
        BlockDuration: 5 * time.Minute,
    }),
})</code></pre>
                </div>

                <h3>Advanced Rate Limiting</h3>
                <div class="code-container">
                    <div class="code-header">advanced_rate_limiter.go</div>
                    <pre><code class="language-go">server.UpdateAppLayer([]EpicServer.AppLayer{
    EpicServer.WithRateLimiter(EpicServer.RateLimiterConfig{
        MaxRequests:   100,
        Interval:      time.Minute,
        BlockDuration: 5 * time.Minute,
        ExcludedPaths: []string{"/health", "/static/*", "/site/*"},
        KeyFunc: func(c *gin.Context) string {
            // Use a combination of IP and User-Agent as the rate limit key
            return c.ClientIP() + "|" + c.Request.UserAgent()
        },
    }),
})</code></pre>
                </div>

                <h3>Rate Limiting Response</h3>
                <p>When a client exceeds the rate limit, EpicServer returns a 429 Too Many Requests response with a Retry-After header indicating when the client can try again.</p>
            </section>

            <section id="csrf" aria-labelledby="csrf-title">
                <h2 id="csrf-title">CSRF Protection</h2>
                <p>Cross-Site Request Forgery (CSRF) is an attack that forces authenticated users to submit a request to a web application against which they are currently authenticated.</p>
                
                <h3>Basic CSRF Protection</h3>
                <div class="code-container">
                    <div class="code-header">csrf_config.go</div>
                    <pre><code class="language-go">server.UpdateAppLayer([]EpicServer.AppLayer{
    EpicServer.WithCSRFProtection(&EpicServer.SessionConfig{
        CookieName:      "session",
        CookieDomain:    "example.com",
        CookieMaxAge:    3600,
        CookieSecure:    true,
        CookieHTTPOnly:  true,
    }),
})</code></pre>
                </div>

                <h3>Using CSRF Tokens in Forms</h3>
                <div class="code-container">
                    <div class="code-header">form_handler.go</div>
                    <pre><code class="language-go">// In your HTML template
&lt;form method="POST" action="/api/submit"&gt;
    &lt;input type="hidden" name="csrf_token" value="{{ .CSRFToken }}"&gt;
    &lt;!-- other form fields --&gt;
    &lt;button type="submit"&gt;Submit&lt;/button&gt;
&lt;/form&gt;

// In your handler
func RenderForm(c *gin.Context, s *EpicServer.Server) {
    token := s.GetCSRFToken(c)
    c.HTML(200, "form.html", gin.H{
        "CSRFToken": token,
    })
}</code></pre>
                </div>

                <h3>Using CSRF Tokens in AJAX Requests</h3>
                <div class="code-container">
                    <div class="code-header">ajax_csrf.js</div>
                    <pre><code class="language-javascript">// JavaScript example
const csrfToken = document.cookie
    .split('; ')
    .find(row => row.startsWith('csrf_token='))
    .split('=')[1];

fetch('/api/submit', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': csrfToken
    },
    body: JSON.stringify({ /* data */ })
})</code></pre>
                </div>
            </section>

            <section id="security-headers" aria-labelledby="security-headers-title">
                <h2 id="security-headers-title">Security Headers</h2>
                <p>Security headers help protect your application from various attacks by instructing browsers how to behave when handling your site's content.</p>
                
                <h3>Adding Security Headers</h3>
                <div class="code-container">
                    <div class="code-header">security_headers.go</div>
                    <pre><code class="language-go">server.UpdateAppLayer([]EpicServer.AppLayer{
    EpicServer.WithSecurityHeaders(),
})</code></pre>
                </div>

                <h3>Default Security Headers</h3>
                <p>EpicServer adds the following security headers by default:</p>
                <table>
                    <tr>
                        <th>Header</th>
                        <th>Value</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td>X-Content-Type-Options</td>
                        <td>nosniff</td>
                        <td>Prevents browsers from interpreting files as a different MIME type</td>
                    </tr>
                    <tr>
                        <td>X-Frame-Options</td>
                        <td>DENY</td>
                        <td>Prevents your page from being displayed in an iframe</td>
                    </tr>
                    <tr>
                        <td>Content-Security-Policy</td>
                        <td>default-src 'self'</td>
                        <td>Restricts the sources of content that can be loaded</td>
                    </tr>
                    <tr>
                        <td>X-XSS-Protection</td>
                        <td>1; mode=block</td>
                        <td>Enables the browser's XSS filter</td>
                    </tr>
                    <tr>
                        <td>Strict-Transport-Security</td>
                        <td>max-age=31536000; includeSubDomains</td>
                        <td>Forces browsers to use HTTPS for your site</td>
                    </tr>
                </table>

                <h3>Custom Security Headers</h3>
                <p>You can customize the security headers by using the Gin middleware directly:</p>
                <div class="code-container">
                    <div class="code-header">custom_headers.go</div>
                    <pre><code class="language-go">server.Engine.Use(func(c *gin.Context) {
    c.Header("X-Content-Type-Options", "nosniff")
    c.Header("X-Frame-Options", "DENY")
    c.Header("Content-Security-Policy", "default-src 'self'; script-src 'self' https://trusted-cdn.com;")
    c.Header("X-XSS-Protection", "1; mode=block")
    c.Header("Strict-Transport-Security", "max-age=31536000; includeSubDomains; preload")
    c.Header("Referrer-Policy", "strict-origin-when-cross-origin")
    c.Header("Permissions-Policy", "camera=(), microphone=(), geolocation=()")
    c.Next()
})</code></pre>
                </div>
            </section>

            <section id="authentication" aria-labelledby="authentication-title">
                <h2 id="authentication-title">Authentication</h2>
                <p>EpicServer provides built-in support for JWT (JSON Web Token) authentication.</p>
                
                <h3>JWT Authentication</h3>
                <div class="code-container">
                    <div class="code-header">jwt_config.go</div>
                    <pre><code class="language-go">server.UpdateAppLayer([]EpicServer.AppLayer{
    EpicServer.WithJWT(EpicServer.JWTConfig{
        SecretKey:  "your-secret-key",
        Expiration: 24 * time.Hour,
    }),
})</code></pre>
                </div>

                <h3>Creating JWT Tokens</h3>
                <div class="code-container">
                    <div class="code-header">login_handler.go</div>
                    <pre><code class="language-go">func Login(c *gin.Context, s *EpicServer.Server) {
    // Validate credentials
    username := c.PostForm("username")
    password := c.PostForm("password")
    
    // Check credentials against database
    user, err := s.DB.GetUserByUsername(username)
    if err != nil || !CheckPasswordHash(password, user.PasswordHash) {
        c.JSON(401, gin.H{"error": "Invalid credentials"})
        return
    }
    
    // Generate JWT token
    token, err := s.GenerateJWT(map[string]interface{}{
        "user_id": user.ID,
        "role":    user.Role,
    })
    if err != nil {
        c.JSON(500, gin.H{"error": "Failed to generate token"})
        return
    }
    
    c.JSON(200, gin.H{"token": token})
}</code></pre>
                </div>

                <h3>Protecting Routes with JWT</h3>
                <div class="code-container">
                    <div class="code-header">protected_routes.go</div>
                    <pre><code class="language-go">server.UpdateAppLayer([]EpicServer.AppLayer{
    EpicServer.WithRoutes(
        EpicServer.RouteGroup{
            Prefix:      "/api/protected",
            Middlewares: []gin.HandlerFunc{EpicServer.JWTAuthMiddleware()},
            Routes: []EpicServer.Route{
                EpicServer.Get("/profile", HandleGetProfile),
            },
        },
    ),
})</code></pre>
                </div>

                <h3>Accessing JWT Claims in Handlers</h3>
                <div class="code-container">
                    <div class="code-header">profile_handler.go</div>
                    <pre><code class="language-go">func HandleGetProfile(c *gin.Context, s *EpicServer.Server) {
    // Get claims from JWT token
    claims, exists := c.Get("jwt_claims")
    if !exists {
        c.JSON(401, gin.H{"error": "Unauthorized"})
        return
    }
    
    // Extract user ID from claims
    userID := claims.(jwt.MapClaims)["user_id"].(float64)
    
    // Get user profile from database
    user, err := s.DB.GetUserByID(int(userID))
    if err != nil {
        c.JSON(500, gin.H{"error": "Failed to fetch user"})
        return
    }
    
    c.JSON(200, user)
}</code></pre>
                </div>
            </section>

            <section id="input-validation" aria-labelledby="input-validation-title">
                <h2 id="input-validation-title">Input Validation</h2>
                <p>Input validation is crucial for preventing injection attacks and ensuring data integrity.</p>
                
                <h3>Using Gin's Binding</h3>
                <div class="code-container">
                    <div class="code-header">validation.go</div>
                    <pre><code class="language-go">type CreateUserRequest struct {
    Username string `json:"username" binding:"required,alphanum,min=4,max=20"`
    Email    string `json:"email" binding:"required,email"`
    Password string `json:"password" binding:"required,min=8"`
    Age      int    `json:"age" binding:"required,gte=18,lte=120"`
}

func CreateUser(c *gin.Context, s *EpicServer.Server) {
    var req CreateUserRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    // Process the validated request
    // ...
    
    c.JSON(201, gin.H{"message": "User created"})
}</code></pre>
                </div>

                <h3>Custom Validation</h3>
                <div class="code-container">
                    <div class="code-header">custom_validation.go</div>
                    <pre><code class="language-go">import (
    "github.com/go-playground/validator/v10"
)

// Custom validation function
func isValidUsername(fl validator.FieldLevel) bool {
    username := fl.Field().String()
    // Check if username exists in database
    exists, _ := checkUsernameExists(username)
    return !exists
}

func main() {
    // ...
    
    // Register custom validator
    if v, ok := binding.Validator.Engine().(*validator.Validate); ok {
        v.RegisterValidation("unique_username", isValidUsername)
    }
    
    // ...
}

type CreateUserRequest struct {
    Username string `json:"username" binding:"required,alphanum,min=4,max=20,unique_username"`
    // ...
}</code></pre>
                </div>
            </section>

            <section id="best-practices" aria-labelledby="best-practices-title">
                <h2 id="best-practices-title">Security Best Practices</h2>
                <p>Here are some security best practices to follow when using EpicServer:</p>
                
                <h3>General Security Practices</h3>
                <ul>
                    <li>Keep EpicServer and all dependencies updated to the latest versions</li>
                    <li>Use HTTPS in production environments</li>
                    <li>Implement proper authentication and authorization</li>
                    <li>Validate all user input</li>
                    <li>Use parameterized queries for database operations</li>
                    <li>Implement proper error handling that doesn't expose sensitive information</li>
                    <li>Use secure password hashing (bcrypt, Argon2)</li>
                    <li>Implement proper logging and monitoring</li>
                    <li>Regularly audit your application for security vulnerabilities</li>
                </ul>

                <h3>Environment-Specific Configuration</h3>
                <div class="code-container">
                    <div class="code-header">env_config.go</div>
                    <pre><code class="language-go">// Development configuration
if server.Config.Environment == "development" {
    // Enable detailed error messages
    server.Engine.Use(gin.Recovery())
} else {
    // Production configuration
    // Use custom recovery middleware that doesn't expose stack traces
    server.Engine.Use(func(c *gin.Context) {
        defer func() {
            if err := recover(); err != nil {
                // Log the error
                server.Logger.Error("Panic recovered", "error", err)
                // Return a generic error message
                c.AbortWithStatusJSON(500, gin.H{"error": "Internal server error"})
            }
        }()
        c.Next()
    })
}</code></pre>
                </div>

                <h3>Secure Password Storage</h3>
                <div class="code-container">
                    <div class="code-header">password.go</div>
                    <pre><code class="language-go">import (
    "golang.org/x/crypto/bcrypt"
)

// Hash a password
func HashPassword(password string) (string, error) {
    bytes, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)
    return string(bytes), err
}

// Check if a password matches a hash
func CheckPasswordHash(password, hash string) bool {
    err := bcrypt.CompareHashAndPassword([]byte(hash), []byte(password))
    return err == nil
}</code></pre>
                </div>
            </section>

            <div class="card">
                <h3>Next Steps</h3>
                <p>Now that you understand the security features, check out these resources:</p>
                <ul>
                    <li><a href="/site/advanced-usage.html">Advanced Usage</a> - Discover advanced techniques and patterns</li>
                    <li><a href="/site/package-reference.html">Package Reference</a> - Detailed documentation of all package types and functions</li>
                </ul>
            </div>
        </article>
    </main>
    
    <footer class="footer">
        <p>Powered by EpicServer - A powerful, flexible, and production-ready web server</p>
        <p>Documentation generated from README.md</p>
    </footer>

    <script>
        // Add a timestamp to the footer
        document.addEventListener('DOMContentLoaded', function() {
            const footer = document.querySelector('.footer');
            if (footer) {
                const timestamp = document.createElement('p');
                timestamp.textContent = 'Last updated: ' + new Date().toLocaleString();
                timestamp.style.fontSize = '0.8em';
                timestamp.setAttribute('data-generated', 'timestamp');
                footer.appendChild(timestamp);
            }
        });
    </script>
</body>
</html> 